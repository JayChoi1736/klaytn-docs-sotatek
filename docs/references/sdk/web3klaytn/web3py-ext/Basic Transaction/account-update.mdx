# Account Update

# Basic

<CH.Spotlight>
<CH.Code>

```py web3_account_update_multisig.py
from web3py_ext import extend
from web3 import Web3
from eth_account import Account
from web3py_ext.klaytn_account.utils import compressed_key
from web3py_ext.transaction.transaction import (
    empty_tx,
    fill_transaction,
    TX_TYPE_ACCOUNT_UPDATE
)
from web3py_ext.utils.klaytn_utils import (
    to_pretty,
    bytes_to_hex_str
)
from cytoolz import merge
from eth_utils.address import to_checksum_address

w3 = Web3(Web3.HTTPProvider('https://public-en-baobab.klaytn.net'))

def web3_account_update_multisig():
    transaction_key = Account.from_key('0xc9668ccd35fc20587aa37a48838b48ccc13cf14dd74c8999dd6a480212d5f7ac')
    update_key = Account.from_key('0x9ba8cb8f60044058a9e6f815c5c42d3a216f47044c61a1750b6d29ddc7f34bda')
    fee_payer_key = Account.from_key('0x0e4ca6d38096ad99324de0dde108587e5d7c600165ae4cd6c2462c597458c2b8')

    account_update_tx = empty_tx(TX_TYPE_ACCOUNT_UPDATE)
    account_update_tx = merge(account_update_tx, {
        'from' : to_checksum_address("0x5bd2fb3c21564c023a4a735935a2b7a238c4ccea"),
        'key' : {
            "type": 5,
            "keys": {
                "roleTransactionKey": {
                    "type":2,
                    "key": compressed_key(transaction_key)
                },
                "roleAccountUpdateKey": {
                    "type":2,
                    "key": compressed_key(update_key)
                },
                "roleFeePayerKey": {
                    "type": 2,
                    "key": compressed_key(fee_payer_key)
                }
            }
        }
    })
    account_update_tx = fill_transaction(account_update_tx, w3)
    print(to_pretty(account_update_tx))

    # sign the klaytn specific transaction type with web3py
    signed_tx = Account.sign_transaction(account_update_tx, update_key.key)
    print('\nrawTransaction:', bytes_to_hex_str(signed_tx.rawTransaction))

    recovered_tx = Account.recover_transaction(signed_tx.rawTransaction)
    print("\nrecovered sender address: ", recovered_tx)

    decoded_tx = Account.decode_transaction(signed_tx.rawTransaction)
    print("\ndecoded transaction:", to_pretty(decoded_tx))

    tx_hash = w3.eth.send_raw_transaction(signed_tx.rawTransaction)
    tx_receipt = w3.eth.wait_for_transaction_receipt(tx_hash)
    print('tx hash: ', tx_hash, 'receipt: ', tx_receipt) 

web3_account_update_multisig()

```




---
```zsh output
❯ py web3_account_update_multisig.py
output
```
</CH.Code>






---

Importing necessary modules and functions from external libraries


```py web3_account_update_multisig.py focus=1:15

```
---

Creating a Web3 instance with the specified Klaytn Baobab testnet URL


```py web3_account_update_multisig.py focus=17

```
---

Also, you can change the default provider. For example, using the alchemy provider.

```py web3_account_update_multisig.py focus=17
from web3py_ext import extend
from web3 import Web3
from eth_account import Account
from web3py_ext.klaytn_account.utils import compressed_key
from web3py_ext.transaction.transaction import (
    empty_tx,
    fill_transaction,
    TX_TYPE_ACCOUNT_UPDATE
)
from web3py_ext.utils.klaytn_utils import (
    to_pretty,
    bytes_to_hex_str
)
from cytoolz import merge
from eth_utils.address import to_checksum_address

w3 = Web3(Web3.HTTPProvider('https://klaytn-mainnet-rpc.allthatnode.com:8551'))

def web3_account_update_multisig():
    transaction_key = Account.from_key('0xc9668ccd35fc20587aa37a48838b48ccc13cf14dd74c8999dd6a480212d5f7ac')
    update_key = Account.from_key('0x9ba8cb8f60044058a9e6f815c5c42d3a216f47044c61a1750b6d29ddc7f34bda')
    fee_payer_key = Account.from_key('0x0e4ca6d38096ad99324de0dde108587e5d7c600165ae4cd6c2462c597458c2b8')

    account_update_tx = empty_tx(TX_TYPE_ACCOUNT_UPDATE)
    account_update_tx = merge(account_update_tx, {
        'from' : to_checksum_address("0x5bd2fb3c21564c023a4a735935a2b7a238c4ccea"),
        'key' : {
            "type": 5,
            "keys": {
                "roleTransactionKey": {
                    "type":2,
                    "key": compressed_key(transaction_key)
                },
                "roleAccountUpdateKey": {
                    "type":2,
                    "key": compressed_key(update_key)
                },
                "roleFeePayerKey": {
                    "type": 2,
                    "key": compressed_key(fee_payer_key)
                }
            }
        }
    })
    account_update_tx = fill_transaction(account_update_tx, w3)
    print(to_pretty(account_update_tx))

    # sign the klaytn specific transaction type with web3py
    signed_tx = Account.sign_transaction(account_update_tx, update_key.key)
    print('\nrawTransaction:', bytes_to_hex_str(signed_tx.rawTransaction))

    recovered_tx = Account.recover_transaction(signed_tx.rawTransaction)
    print("\nrecovered sender address: ", recovered_tx)

    decoded_tx = Account.decode_transaction(signed_tx.rawTransaction)
    print("\ndecoded transaction:", to_pretty(decoded_tx))

    tx_hash = w3.eth.send_raw_transaction(signed_tx.rawTransaction)
    tx_receipt = w3.eth.wait_for_transaction_receipt(tx_hash)
    print('tx hash: ', tx_hash, 'receipt: ', tx_receipt) 

web3_account_update_multisig()
    

```
---
Creating Ethereum accounts from private keys for transaction, update, and fee payer keys



```py web3_account_update_multisig.py focus=20:22

```
---

Creating an empty transaction of type TX_TYPE_ACCOUNT_UPDATE


```py web3_account_update_multisig.py focus=24

```
---
Merging additional data into the transaction, including the sender's address and keys for roles



```py web3_account_update_multisig.py focus=25:44
```
---
Filling in additional transaction details using the Web3 library



```py web3_account_update_multisig.py focus=45

```
---

Printing the formatted transaction details


```py web3_account_update_multisig.py focus=46

```
---

Signing the Klaytn specific transaction type with web3py


```py web3_account_update_multisig.py focus=49:50

```
---

Recovering the sender's address from the signed transaction


```py web3_account_update_multisig.py focus=52:53

```
---

Decoding the signed transaction for better readability


```py web3_account_update_multisig.py focus=55:56

```
---

Sending the signed transaction to the network and waiting for the receipt


```py web3_account_update_multisig.py focus=58:60

```
---




</CH.Spotlight>

# Fee Delegation


<CH.Spotlight>
<CH.Code>

```py web3_fee_delegated_account_update_multisig.py
from web3py_ext import extend
from web3 import Web3
from eth_account import Account
from web3py_ext.klaytn_account.utils import compressed_key
from web3py_ext.transaction.transaction import (
    empty_tx,
    fill_transaction,
    TX_TYPE_FEE_DELEGATED_ACCOUNT_UPDATE
)
from web3py_ext.utils.klaytn_utils import (
    to_pretty,
    bytes_to_hex_str
)
from cytoolz import merge

w3 = Web3(Web3.HTTPProvider('http://127.0.0.1:8551'))

def web3_fee_delegated_account_update_multisig():
    user1 = Account.from_key('0xd3973803956f7f08093097fa2c3712f5700c5c58f6d91d79b279a919bb120cc2')
    user2 = Account.from_key('0xedb106f1dcd74b7fb55252051359b5b162f93de0fb8b5aa0c46319f864192c29')
    user3 = Account.from_key('0x797d16ee04c7cec1cf1d4a536fd2dfed81af48d477df1f8409d75f50d91499f6')
    fee_delegator = Account.from_key('0x2380a434b66b5b3ff095632b098055e52fa85ca34517ff8ec504b428f4a81f76')

    account_update_tx = empty_tx(TX_TYPE_FEE_DELEGATED_ACCOUNT_UPDATE)
    account_update_tx = merge(account_update_tx, {
        'from' : user1.address,
        'key' : {
            'type': 4,
            'threshold': 2,
            'keys': [
                {
                    'weight':1,
                    'key': compressed_key(user2),
                },
                {
                    'weight':1,
                    'key': compressed_key(user1),
                },
                {
                    'weight':1,
                    'key': compressed_key(user3),
                },
            ] 
        }
    })
    account_update_tx = fill_transaction(account_update_tx, w3)
    print(to_pretty(account_update_tx))

    # sign the klaytn specific transaction type with web3py
    signed_tx = Account.sign_transaction(account_update_tx, user1.key)
    print('\nrawTransaction:', bytes_to_hex_str(signed_tx.rawTransaction))

    recovered_tx = Account.recover_transaction(signed_tx.rawTransaction)
    print("\nrecovered sender address: ", recovered_tx)

    decoded_tx = Account.decode_transaction(signed_tx.rawTransaction)
    print("\ndecoded transaction:", to_pretty(decoded_tx))
    
    feepayer_signed_tx = Account.sign_transaction_as_feepayer(signed_tx.rawTransaction, fee_delegator.address, fee_delegator.key)
    print("\nraw transaction of feePayer signed tx:", feepayer_signed_tx.rawTransaction.hex())
    
    feepayer_recovered_tx = Account.recover_transaction_as_feepayer(feepayer_signed_tx.rawTransaction)
    print("recovered feepayer address:", feepayer_recovered_tx)
    
    decoded_tx = Account.decode_transaction(feepayer_signed_tx.rawTransaction)
    print("\ndecoded transaction:", to_pretty(decoded_tx))

web3_fee_delegated_account_update_multisig()

```




---
```zsh output
❯ py web3_fee_delegated_account_update_multisig.py
output
```
</CH.Code>






---

Importing necessary modules and functions from external libraries


```py web3_fee_delegated_account_update_multisig.py focus=1:14

```
---
Creating a Web3 instance with a local Klaytn node URL



```py web3_fee_delegated_account_update_multisig.py focus=16

```
---

Also, you can change the default provider. For example, using the alchemy provider.

```py web3_fee_delegated_account_update_multisig.py focus=16
from web3py_ext import extend
from web3 import Web3
from eth_account import Account
from web3py_ext.klaytn_account.utils import compressed_key
from web3py_ext.transaction.transaction import (
    empty_tx,
    fill_transaction,
    TX_TYPE_FEE_DELEGATED_ACCOUNT_UPDATE
)
from web3py_ext.utils.klaytn_utils import (
    to_pretty,
    bytes_to_hex_str
)
from cytoolz import merge

w3 = Web3(Web3.HTTPProvider('https://klaytn-mainnet-rpc.allthatnode.com:8551'))

def web3_fee_delegated_account_update_multisig():
    user1 = Account.from_key('0xd3973803956f7f08093097fa2c3712f5700c5c58f6d91d79b279a919bb120cc2')
    user2 = Account.from_key('0xedb106f1dcd74b7fb55252051359b5b162f93de0fb8b5aa0c46319f864192c29')
    user3 = Account.from_key('0x797d16ee04c7cec1cf1d4a536fd2dfed81af48d477df1f8409d75f50d91499f6')
    fee_delegator = Account.from_key('0x2380a434b66b5b3ff095632b098055e52fa85ca34517ff8ec504b428f4a81f76')

    account_update_tx = empty_tx(TX_TYPE_FEE_DELEGATED_ACCOUNT_UPDATE)
    account_update_tx = merge(account_update_tx, {
        'from' : user1.address,
        'key' : {
            'type': 4,
            'threshold': 2,
            'keys': [
                {
                    'weight':1,
                    'key': compressed_key(user2),
                },
                {
                    'weight':1,
                    'key': compressed_key(user1),
                },
                {
                    'weight':1,
                    'key': compressed_key(user3),
                },
            ] 
        }
    })
    account_update_tx = fill_transaction(account_update_tx, w3)
    print(to_pretty(account_update_tx))

    # sign the klaytn specific transaction type with web3py
    signed_tx = Account.sign_transaction(account_update_tx, user1.key)
    print('\nrawTransaction:', bytes_to_hex_str(signed_tx.rawTransaction))

    recovered_tx = Account.recover_transaction(signed_tx.rawTransaction)
    print("\nrecovered sender address: ", recovered_tx)

    decoded_tx = Account.decode_transaction(signed_tx.rawTransaction)
    print("\ndecoded transaction:", to_pretty(decoded_tx))
    
    feepayer_signed_tx = Account.sign_transaction_as_feepayer(signed_tx.rawTransaction, fee_delegator.address, fee_delegator.key)
    print("\nraw transaction of feePayer signed tx:", feepayer_signed_tx.rawTransaction.hex())
    
    feepayer_recovered_tx = Account.recover_transaction_as_feepayer(feepayer_signed_tx.rawTransaction)
    print("recovered feepayer address:", feepayer_recovered_tx)
    
    decoded_tx = Account.decode_transaction(feepayer_signed_tx.rawTransaction)
    print("\ndecoded transaction:", to_pretty(decoded_tx))

web3_fee_delegated_account_update_multisig()
    

```
---

Creating Ethereum accounts from private keys for users and fee delegator


```py web3_fee_delegated_account_update_multisig.py focus=19:22

```
---
Creating an empty transaction of type TX_TYPE_FEE_DELEGATED_ACCOUNT_UPDATE


```py web3_fee_delegated_account_update_multisig.py focus=24

```
---

Merging additional data into the transaction, including the sender's address and multisig key structure


```py web3_fee_delegated_account_update_multisig.py focus=25:45

```
---

Filling in additional transaction details using the Web3 library, using **to_pretty** for better format.


```py web3_fee_delegated_account_update_multisig.py focus=46:47

```
---

Signing the Klaytn specific transaction type with web3py.


```py web3_fee_delegated_account_update_multisig.py focus=50:51

```
---
Recovering the sender's address from the signed transaction



```py web3_fee_delegated_account_update_multisig.py focus=53:57

```
---
Signing the transaction as a fee payer with the fee delegator's account



```py web3_fee_delegated_account_update_multisig.py focus=59:60

```
---

Recovering the fee payer's address from the signed fee-payer transaction


```py web3_fee_delegated_account_update_multisig.py focus=62:63

```
---

Decoding the signed fee-payer transaction for better readability


```py web3_fee_delegated_account_update_multisig.py focus=65:66

```



</CH.Spotlight>